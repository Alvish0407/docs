"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[828],{3905:(e,t,r)=>{r.d(t,{Zo:()=>s,kt:()=>c});var a=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e,t){if(null==e)return{};var r,a,o=function(e,t){if(null==e)return{};var r,a,o={},n=Object.keys(e);for(a=0;a<n.length;a++)r=n[a],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)r=n[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var p=a.createContext({}),l=function(e){var t=a.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},s=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var r=e.components,o=e.mdxType,n=e.originalType,p=e.parentName,s=d(e,["components","mdxType","originalType","parentName"]),u=l(r),m=o,c=u["".concat(p,".").concat(m)]||u[m]||h[m]||n;return r?a.createElement(c,i(i({ref:t},s),{},{components:r})):a.createElement(c,i({ref:t},s))}));function c(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var n=r.length,i=new Array(n);i[0]=m;var d={};for(var p in t)hasOwnProperty.call(t,p)&&(d[p]=t[p]);d.originalType=e,d[u]="string"==typeof e?e:o,i[1]=d;for(var l=2;l<n;l++)i[l]=r[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}m.displayName="MDXCreateElement"},4088:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>h,frontMatter:()=>n,metadata:()=>d,toc:()=>l});var a=r(7462),o=(r(7294),r(3905));const n={sidebar_position:1,title:"Android | Hybrid App",sidebar_label:"\ud83e\udd16 Android",description:"Use code push in an hybrid app scenario with an Android app"},i="Code Push In Hybrid Apps",d={unversionedId:"guides/hybrid-app/android",id:"guides/hybrid-app/android",title:"Android | Hybrid App",description:"Use code push in an hybrid app scenario with an Android app",source:"@site/docs/guides/hybrid-app/android.md",sourceDirName:"guides/hybrid-app",slug:"/guides/hybrid-app/android",permalink:"/guides/hybrid-app/android",draft:!1,editUrl:"https://github.com/shorebirdtech/docs/tree/main/docs/guides/hybrid-app/android.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Android | Hybrid App",sidebar_label:"\ud83e\udd16 Android",description:"Use code push in an hybrid app scenario with an Android app"},sidebar:"tutorialSidebar",previous:{title:"\ud83e\uddbf Hybrid Apps",permalink:"/guides/hybrid-app"},next:{title:"\ud83c\udf4e iOS",permalink:"/guides/hybrid-app/ios"}},p={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Add Shorebird to your Flutter module",id:"add-shorebird-to-your-flutter-module",level:2},{value:"Create a Shorebird release",id:"create-a-shorebird-release",level:2},{value:"Update your Android app to use the <code>download.shorebird.dev</code> Maven repository",id:"update-your-android-app-to-use-the-downloadshorebirddev-maven-repository",level:2},{value:"Update your Android app to use this version of the Flutter module",id:"update-your-android-app-to-use-this-version-of-the-flutter-module",level:2},{value:"Verify that your app runs",id:"verify-that-your-app-runs",level:2},{value:"Submit your app to the Play Store",id:"submit-your-app-to-the-play-store",level:2},{value:"Verify that Shorebird is working with a patch",id:"verify-that-shorebird-is-working-with-a-patch",level:2}],s={toc:l},u="wrapper";function h(e){let{components:t,...r}=e;return(0,o.kt)(u,(0,a.Z)({},s,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"code-push-in-hybrid-apps"},"Code Push In Hybrid Apps"),(0,o.kt)("p",null,"This guide explains how to use Shorebird in an Android hybrid app scenario (that is, your app embeds Flutter UI in non-Flutter UI)."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"If your app is a pure Flutter app, follow the ",(0,o.kt)("a",{parentName:"p",href:"../../code-push"},"standard code push guide")," instead.")),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("p",null,"This guide assumes you have already have an Android app and a Flutter module. Our Android app will be named ",(0,o.kt)("inlineCode",{parentName:"p"},"android_app")," and our Flutter module will be named ",(0,o.kt)("inlineCode",{parentName:"p"},"flutter_module"),"."),(0,o.kt)("p",null,"This guide also assumes that you have created a Shorebird account. If you have not, please see our ",(0,o.kt)("a",{parentName:"p",href:"../../code-push"},"code push guide")," for instructions."),(0,o.kt)("p",null,"The reference code for this guide is available at ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/shorebirdtech/samples/tree/main/add_to_app"},"https://github.com/shorebirdtech/samples/tree/main/add_to_app"),"."),(0,o.kt)("h2",{id:"add-shorebird-to-your-flutter-module"},"Add Shorebird to your Flutter module"),(0,o.kt)("p",null,"First, run ",(0,o.kt)("inlineCode",{parentName:"p"},"shorebird init")," in your Flutter module:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"shorebird init\n")),(0,o.kt)("h2",{id:"create-a-shorebird-release"},"Create a Shorebird release"),(0,o.kt)("p",null,"Create a Shorebird release for your Flutter module:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"shorebird release aar --release-version 1.2.3+1\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"release-version")," parameter needs to match the version of the Android app\nthat uses this module (i.e., ",(0,o.kt)("inlineCode",{parentName:"p"},"versionName+versionCode")," from the app's\n",(0,o.kt)("inlineCode",{parentName:"p"},"app/build.gradle")," file)."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Because Shorebird only works with release builds, this will only produce a\nrelease version of your archive. This is similar to running\n",(0,o.kt)("inlineCode",{parentName:"p"},"flutter build aar --no-debug --no-profile"),".")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"This command creates an ",(0,o.kt)("inlineCode",{parentName:"p"},"aar")," with a build number of ",(0,o.kt)("inlineCode",{parentName:"p"},"1.0"),". As with the\n",(0,o.kt)("inlineCode",{parentName:"p"},"flutter build aar")," command, you may optionally provide a different build number\nusing the ",(0,o.kt)("inlineCode",{parentName:"p"},"--build-number")," argument, although this is not necessary. The build\nnumber is used to identify the Flutter module in your app's ",(0,o.kt)("inlineCode",{parentName:"p"},"build.gradle")," file,\nas you can see\n",(0,o.kt)("a",{parentName:"p",href:"#update-your-android-app-to-use-this-version-of-the-flutter-module"},"below"),"."),(0,o.kt)("p",{parentName:"admonition"},"Shorebird does not use the build number, but ",(0,o.kt)("strong",{parentName:"p"},"it should remain consistent\nbetween a release and patches to that release"),".")),(0,o.kt)("h2",{id:"update-your-android-app-to-use-the-downloadshorebirddev-maven-repository"},"Update your Android app to use the ",(0,o.kt)("inlineCode",{parentName:"h2"},"download.shorebird.dev")," Maven repository"),(0,o.kt)("p",null,"In ",(0,o.kt)("inlineCode",{parentName:"p"},"settings.gradle"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"dependencyResolutionManagement {\n    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)\n    repositories {\n        google()\n        mavenCentral()\n+        maven {\n+           // This is a relative path from this settings.gradle file to the\n+           // my_flutter_module/build/host/outputs/repo directory.\n+           url '../my_flutter_module/release'\n+       }\n+       maven {\n-           url 'https://storage.googleapis.com/download.flutter.io'\n+           url 'https://download.shorebird.dev/download.flutter.io'\n+      }\n    }\n}\n")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Even though we are replacing ",(0,o.kt)("a",{parentName:"p",href:"https://storage.googleapis.com/download.flutter.io"},"https://storage.googleapis.com/download.flutter.io"),".\nwith ",(0,o.kt)("a",{parentName:"p",href:"https://download.shorebird.dev/download.flutter.io"},"https://download.shorebird.dev/download.flutter.io"),", any Flutter\ndependencies that are not unique to Shorebird will still be downloaded from\n",(0,o.kt)("a",{parentName:"p",href:"https://storage.googleapis.com/download.flutter.io"},"https://storage.googleapis.com/download.flutter.io"),". This will only work for\nversions of Flutter that Shorebird supports.")),(0,o.kt)("h2",{id:"update-your-android-app-to-use-this-version-of-the-flutter-module"},"Update your Android app to use this version of the Flutter module"),(0,o.kt)("p",null,"In ",(0,o.kt)("inlineCode",{parentName:"p"},"app/build.gradle"),", add the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"dependencies {\n    // ...\n+    releaseImplementation 'com.example.my_flutter_module:flutter_release:1.0'\n    // ...\n}\n")),(0,o.kt)("h2",{id:"verify-that-your-app-runs"},"Verify that your app runs"),(0,o.kt)("p",null,"In Android Studio, update the active build variant to release and run your app.\nYour app should work as before with no differences."),(0,o.kt)("p",null,'To set the active build variant to release, click on the "Build Variants" tab in\nthe lower left corner of Android Studio. Then select "release" from the\n"Active Build Variant" dropdown.\n',(0,o.kt)("img",{parentName:"p",src:"https://github.com/shorebirdtech/docs/assets/581764/91b68c2c-7cee-44f1-a78a-eec443c353a3",alt:"Screenshot 2023-10-06 at 1 15 14 PM"})),(0,o.kt)("admonition",{type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"Attempting to build with a non-release build variant will not be able to resolve\nFlutter symbols in your app.")),(0,o.kt)("h2",{id:"submit-your-app-to-the-play-store"},"Submit your app to the Play Store"),(0,o.kt)("p",null,"We won't cover this step in detail here, but this is where you would submit your\napp to the Play Store. For code push to work, it is important that you submit\n",(0,o.kt)("em",{parentName:"p"},"with the same ",(0,o.kt)("inlineCode",{parentName:"em"},"aar")," generated by the release command above"),"."),(0,o.kt)("h2",{id:"verify-that-shorebird-is-working-with-a-patch"},"Verify that Shorebird is working with a patch"),(0,o.kt)("p",null,"Make an edit to the code in your Flutter module. Then run:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"shorebird patch aar --release-version 1.2.3+1\n")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"If you provided a build number to the ",(0,o.kt)("inlineCode",{parentName:"p"},"shorebird release aar")," command using the\n",(0,o.kt)("inlineCode",{parentName:"p"},"--build-number")," argument, you must also provide that same build number to the\n",(0,o.kt)("inlineCode",{parentName:"p"},"shorebird patch aar")," command.")),(0,o.kt)("p",null,"As with the ",(0,o.kt)("inlineCode",{parentName:"p"},"release")," command, the release version should be the version of the\nAndroid app that uses this module."),(0,o.kt)("p",null,"Now relaunch the app, navigate to the Flutter screen, and verify that the patch\nis recognized and applied. In logcat, you should see output like the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'[INFO:shorebird.cc(109)] Shorebird updater: no active patch.\n[INFO:shorebird.cc(113)] Starting Shorebird update\nupdater::network: Sending patch check request: PatchCheckRequest { app_id: "baad0583-6810-44a7-9034-6aadb8127f29", channel: "stable", release_version: "1.0.0+8", patch_number: None, platform: "android", arch: "aarch64" }\nupdater::updater: Patch 1 successfully installed.\nupdater::updater: Update thread finished with status: Update installed\n')))}h.isMDXComponent=!0}}]);